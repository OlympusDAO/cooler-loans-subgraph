# Mirrors the Request struct in Cooler.sol
type CoolerLoanRequest @entity {
  id: String! # cooler-requestId
  createdBlock: BigInt!
  createdTimestamp: BigInt!
  createdTransaction: Bytes!
  cooler: Bytes! # address
  requestId: BigInt! # uint256
  borrower: Bytes! # address
  collateralToken: Bytes! # address
  debtToken: Bytes! # address
  amount: BigDecimal! # amount to be borrowed
  interestPercentage: BigDecimal! # annualized percentage to be paid as interest. Represented as a decimal, e.g. 0.1 = 10%
  loanToCollateralRatio: BigDecimal! # ratio of the quantity of debt token to 1 collateral token, e.g. 3000 DAI/gOHM
  durationSeconds: BigInt! # duration of loan in seconds
  isRescinded: Boolean!
  # Related records
  requestEvents: [RequestLoanEvent!]! @derivedFrom(field: "request")
  rescindEvents: [RescindLoanRequestEvent!]! @derivedFrom(field: "request")
  clearEvents: [ClearLoanRequestEvent!]! @derivedFrom(field: "request")
  loans: [CoolerLoan!]! @derivedFrom(field: "request")
}

# Mirrors the Loan struct in Cooler.sol
type CoolerLoan @entity(immutable: true) {
  id: String! # cooler-loanId
  createdBlock: BigInt!
  createdTimestamp: BigInt!
  createdTransaction: Bytes!
  cooler: Bytes! # address
  request: CoolerLoanRequest! # request that created this loan
  loanId: BigInt! # uint256
  borrower: Bytes! # address
  lender: Bytes! # address
  amount: BigDecimal! # Total amount of debt, including interest
  interest: BigDecimal!
  principal: BigDecimal!
  unclaimed: BigDecimal!
  collateral: BigDecimal!
  expiryTimestamp: BigInt!
  repayDirect: Boolean!
  hasCallback: Boolean!
  collateralToken: Bytes! # address
  debtToken: Bytes! # address
  # Related records
  creationEvents: [ClearLoanRequestEvent!]! @derivedFrom(field: "loan")
  defaultedClaimEvents: [ClaimDefaultedLoanEvent!]! @derivedFrom(field: "loan")
  repaymentEvents: [RepayLoanEvent!]! @derivedFrom(field: "loan")
  rolloverEvents: [RollLoanEvent!]! @derivedFrom(field: "loan")
}

type ClearinghouseSnapshot @entity {
  id: String! # address-blockNumber
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  clearinghouse: Bytes! # address
  # State information
  isActive: Boolean!
  nextRebalanceTimestamp: BigInt!
  receivables: BigDecimal!
  # Capacity
  daiBalance: BigDecimal!
  sDaiBalance: BigDecimal!
  sDaiInDaiBalance: BigDecimal!
}

### Events

type RequestLoanEvent @entity(immutable: true) {
  # Context
  id: String! # cooler-requestId
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
  request: CoolerLoanRequest!
}

type RescindLoanRequestEvent @entity(immutable: true) {
  # Context
  id: String! # cooler-requestId
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
  request: CoolerLoanRequest!
}

type ClearLoanRequestEvent @entity(immutable: true) {
  # Context
  id: String! # cooler-requestId
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
  # Event information
  request: CoolerLoanRequest!
  loan: CoolerLoan!
}

type ClaimDefaultedLoanEvent @entity(immutable: true) {
  # Context
  id: String! # cooler-loanId
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
  # Loan information
  loan: CoolerLoan!
  secondsSinceExpiry: BigInt!
  # Income
  collateralQuantityClaimed: BigDecimal!
  collateralPrice: BigDecimal!
  collateralValueClaimed: BigDecimal!
  collateralIncome: BigDecimal!
}

type RepayLoanEvent @entity(immutable: true) {
  # Context
  id: String! # cooler-loanId-blockNumber
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
  # Loan information
  loan: CoolerLoan!
  secondsToExpiry: BigInt!
  loanPayable: BigDecimal!
  collateralDeposited: BigDecimal!
  repaidUnclaimed: BigDecimal!
  # Event information
  amountPaid: BigDecimal!
  # Income
  interestIncome: BigDecimal!
}

type RollLoanEvent @entity(immutable: true) {
  # Context
  id: String! # cooler-loanId-blockNumber
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
  # Loan information
  loan: CoolerLoan!
  # Event information
  newDebtQuantity: BigDecimal!
  newCollateralQuantity: BigDecimal!
  newExpiryTimestamp: BigInt!
}
